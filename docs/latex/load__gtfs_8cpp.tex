\hypertarget{load__gtfs_8cpp}{}\section{src/load\+\_\+gtfs.cpp File Reference}
\label{load__gtfs_8cpp}\index{src/load\+\_\+gtfs.\+cpp@{src/load\+\_\+gtfs.\+cpp}}
{\ttfamily \#include $<$iostream$>$}\\*
{\ttfamily \#include $<$vector$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$fstream$>$}\\*
{\ttfamily \#include $<$algorithm$>$}\\*
{\ttfamily \#include $<$boost/program\+\_\+options.\+hpp$>$}\\*
{\ttfamily \#include $<$sqlite3.\+h$>$}\\*
{\ttfamily \#include \char`\"{}gps.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}gtfs.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}json.\+hpp\char`\"{}}\\*
Include dependency graph for load\+\_\+gtfs.\+cpp\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{load__gtfs_8cpp__incl}
\end{center}
\end{figure}
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structSplit}{Split}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}{system} (std\+::string const \&s)
\item 
void \hyperlink{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}{import\+\_\+intersections} (sqlite3 $\ast$db, std\+::vector$<$ std\+::string $>$ files)
\item 
void \hyperlink{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}{set\+\_\+distances} (sqlite3 $\ast$db)
\item 
std\+::vector$<$ \hyperlink{structSplit}{Split} $>$ \hyperlink{load__gtfs_8cpp_af82110f83438bd672ded68a2451e69f7}{find\+\_\+intersections} (std\+::shared\+\_\+ptr$<$ \hyperlink{classgtfs_1_1Shape}{gtfs\+::\+Shape} $>$ shape, std\+::vector$<$ \hyperlink{classgtfs_1_1Intersection}{gtfs\+::\+Intersection} $>$ \&intersections)
\item 
void {\bfseries segment\+\_\+shapes} (sqlite3 $\ast$db)\hypertarget{load__gtfs_8cpp_a4c73441dc3489abcadf91f57dd472673}{}\label{load__gtfs_8cpp_a4c73441dc3489abcadf91f57dd472673}

\item 
void {\bfseries calculate\+\_\+stop\+\_\+distances} (std\+::string \&dbname)\hypertarget{load__gtfs_8cpp_afc0ec9cd72ffe92b7aacb7c58aeea6b3}{}\label{load__gtfs_8cpp_afc0ec9cd72ffe92b7aacb7c58aeea6b3}

\item 
int \hyperlink{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Load the most recent G\+T\+FS static data from Auckland Transport.

This program will populate the supplied database with the most recent version of the G\+T\+FS static feed from Auckland Transport.

Segmentation will take place, in which shapes are split at intersections. Routes will be compared to existing routes, and if there are no changes the segments will simply be duplicated; otherwise new segments will be created.

\begin{DoxyAuthor}{Author}
Tom Elliott \href{mailto:tom.elliott@auckland.ac.nz}{\tt tom.\+elliott@auckland.\+ac.\+nz} 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+0.\+1 
\end{DoxyVersion}


\subsection{Function Documentation}
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!find\+\_\+intersections@{find\+\_\+intersections}}
\index{find\+\_\+intersections@{find\+\_\+intersections}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection[{\texorpdfstring{find\+\_\+intersections(std\+::shared\+\_\+ptr$<$ gtfs\+::\+Shape $>$ shape, std\+::vector$<$ gtfs\+::\+Intersection $>$ \&intersections)}{find_intersections(std::shared_ptr< gtfs::Shape > shape, std::vector< gtfs::Intersection > &intersections)}}]{\setlength{\rightskip}{0pt plus 5cm}std\+::vector$<$ {\bf Split} $>$ find\+\_\+intersections (
\begin{DoxyParamCaption}
\item[{std\+::shared\+\_\+ptr$<$ {\bf gtfs\+::\+Shape} $>$}]{shape, }
\item[{std\+::vector$<$ {\bf gtfs\+::\+Intersection} $>$ \&}]{intersections}
\end{DoxyParamCaption}
)}\hypertarget{load__gtfs_8cpp_af82110f83438bd672ded68a2451e69f7}{}\label{load__gtfs_8cpp_af82110f83438bd672ded68a2451e69f7}
Find intersections along a path (multiple if it loops etc). 
\begin{DoxyParams}{Parameters}
{\em path} & path to look through \\
\hline
{\em intersections} & possible intersections \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
vector of split points 
\end{DoxyReturn}
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!import\+\_\+intersections@{import\+\_\+intersections}}
\index{import\+\_\+intersections@{import\+\_\+intersections}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection[{\texorpdfstring{import\+\_\+intersections(sqlite3 $\ast$db, std\+::vector$<$ std\+::string $>$ files)}{import_intersections(sqlite3 *db, std::vector< std::string > files)}}]{\setlength{\rightskip}{0pt plus 5cm}void import\+\_\+intersections (
\begin{DoxyParamCaption}
\item[{sqlite3 $\ast$}]{db, }
\item[{std\+::vector$<$ std\+::string $>$}]{files}
\end{DoxyParamCaption}
)}\hypertarget{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}{}\label{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}
Import insersections from a J\+S\+ON file into the database.

Additionally, clusters of \char`\"{}points\char`\"{} belonging to the same intersection are combined into a single object.


\begin{DoxyParams}{Parameters}
{\em db} & the database to use \\
\hline
{\em files} & the files to load intersections from \\
\hline
\end{DoxyParams}
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!main@{main}}
\index{main@{main}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection[{\texorpdfstring{main(int argc, char $\ast$argv[])}{main(int argc, char *argv[])}}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}\hypertarget{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{}\label{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}
Loads G\+T\+FS file into database and segments as necessary.


\begin{DoxyParams}{Parameters}
{\em argc} & number of command line arguments \\
\hline
{\em argv} & arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if everything went OK; 1 if it didn\textquotesingle{}t 
\end{DoxyReturn}
database connection to use \index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!set\+\_\+distances@{set\+\_\+distances}}
\index{set\+\_\+distances@{set\+\_\+distances}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection[{\texorpdfstring{set\+\_\+distances(sqlite3 $\ast$db)}{set_distances(sqlite3 *db)}}]{\setlength{\rightskip}{0pt plus 5cm}void set\+\_\+distances (
\begin{DoxyParamCaption}
\item[{sqlite3 $\ast$}]{db}
\end{DoxyParamCaption}
)}\hypertarget{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}{}\label{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}
Set distance in database for segments and stops

To reduce reads, perform all at once, route by route. For each route
\begin{DoxyItemize}
\item load associated shape data into a Shape object
\item find intersections (in path order)
\begin{DoxyItemize}
\item (use code from segment\+\_\+shape fn)
\end{DoxyItemize}
\item load stops
\item travel along path computing distance traveled for each stop and intersection along the way
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em db} & the database to use \\
\hline
\end{DoxyParams}
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!system@{system}}
\index{system@{system}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection[{\texorpdfstring{system(std\+::string const \&s)}{system(std::string const &s)}}]{\setlength{\rightskip}{0pt plus 5cm}int system (
\begin{DoxyParamCaption}
\item[{std\+::string const \&}]{s}
\end{DoxyParamCaption}
)}\hypertarget{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}{}\label{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}
A \hyperlink{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}{system()} command that takes a std\+::string instead of a char. 
\begin{DoxyParams}{Parameters}
{\em s} & The command to run. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The return value from the system command. 
\end{DoxyReturn}
