\hypertarget{load__gtfs_8cpp}{}\section{src/load\+\_\+gtfs.cpp File Reference}
\label{load__gtfs_8cpp}\index{src/load\+\_\+gtfs.\+cpp@{src/load\+\_\+gtfs.\+cpp}}
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$vector$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$fstream$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$boost/program\+\_\+options.\+hpp$>$}\newline
{\ttfamily \#include $<$sqlite3.\+h$>$}\newline
{\ttfamily \#include \char`\"{}gps.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}gtfs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}json.\+hpp\char`\"{}}\newline
Include dependency graph for load\+\_\+gtfs.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{load__gtfs_8cpp__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}{system} (std\+::string const \&s)
\item 
void \hyperlink{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}{import\+\_\+intersections} (sqlite3 $\ast$db, std\+::vector$<$ std\+::string $>$ files)
\item 
void \hyperlink{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}{set\+\_\+distances} (sqlite3 $\ast$db)
\item 
void \hyperlink{load__gtfs_8cpp_a4c73441dc3489abcadf91f57dd472673}{segment\+\_\+shapes} (sqlite3 $\ast$db)
\item 
\mbox{\Hypertarget{load__gtfs_8cpp_afc0ec9cd72ffe92b7aacb7c58aeea6b3}\label{load__gtfs_8cpp_afc0ec9cd72ffe92b7aacb7c58aeea6b3}} 
void {\bfseries calculate\+\_\+stop\+\_\+distances} (std\+::string \&dbname)
\item 
int \hyperlink{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Load the most recent G\+T\+FS static data from Auckland Transport.

This program will populate the supplied database with the most recent version of the G\+T\+FS static feed from Auckland Transport.

Segmentation will take place, in which shapes are split at intersections. Routes will be compared to existing routes, and if there are no changes the segments will simply be duplicated; otherwise new segments will be created.

\begin{DoxyAuthor}{Author}
Tom Elliott \href{mailto:tom.elliott@auckland.ac.nz}{\tt tom.\+elliott@auckland.\+ac.\+nz} 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+0.\+1 
\end{DoxyVersion}


\subsection{Function Documentation}
\mbox{\Hypertarget{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}\label{load__gtfs_8cpp_a54ef9ab4a1985152c9cf7ec290fbea2d}} 
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!import\+\_\+intersections@{import\+\_\+intersections}}
\index{import\+\_\+intersections@{import\+\_\+intersections}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection{\texorpdfstring{import\+\_\+intersections()}{import\_intersections()}}
{\footnotesize\ttfamily void import\+\_\+intersections (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db,  }\item[{std\+::vector$<$ std\+::string $>$}]{files }\end{DoxyParamCaption})}

Import insersections from a J\+S\+ON file into the database.

Additionally, clusters of \char`\"{}points\char`\"{} belonging to the same intersection are combined into a single object.


\begin{DoxyParams}{Parameters}
{\em db} & the database to use \\
\hline
{\em files} & the files to load intersections from \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{load__gtfs_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!main@{main}}
\index{main@{main}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}

Loads G\+T\+FS file into database and segments as necessary.


\begin{DoxyParams}{Parameters}
{\em argc} & number of command line arguments \\
\hline
{\em argv} & arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if everything went OK; 1 if it didn\textquotesingle{}t 
\end{DoxyReturn}
database connection to use \mbox{\Hypertarget{load__gtfs_8cpp_a4c73441dc3489abcadf91f57dd472673}\label{load__gtfs_8cpp_a4c73441dc3489abcadf91f57dd472673}} 
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!segment\+\_\+shapes@{segment\+\_\+shapes}}
\index{segment\+\_\+shapes@{segment\+\_\+shapes}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection{\texorpdfstring{segment\+\_\+shapes()}{segment\_shapes()}}
{\footnotesize\ttfamily void segment\+\_\+shapes (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db }\end{DoxyParamCaption})}

Segment shapes.


\begin{DoxyParams}{Parameters}
{\em db} & a database connection \\
\hline
\end{DoxyParams}
A split object, used only to find intersections at which to split the route.\mbox{\Hypertarget{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}\label{load__gtfs_8cpp_a2f86801b49d8f0b1649a9edc0e197172}} 
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!set\+\_\+distances@{set\+\_\+distances}}
\index{set\+\_\+distances@{set\+\_\+distances}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection{\texorpdfstring{set\+\_\+distances()}{set\_distances()}}
{\footnotesize\ttfamily void set\+\_\+distances (\begin{DoxyParamCaption}\item[{sqlite3 $\ast$}]{db }\end{DoxyParamCaption})}

Set distance in database for segments and stops

To reduce reads, perform all at once, route by route. For each route
\begin{DoxyItemize}
\item load associated shape data into a Shape object
\item find intersections (in path order)
\begin{DoxyItemize}
\item (use code from segment\+\_\+shape fn)
\end{DoxyItemize}
\item load stops
\item travel along path computing distance traveled for each stop and intersection along the way
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em db} & the database to use \\
\hline
\end{DoxyParams}
\mbox{\Hypertarget{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}\label{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}} 
\index{load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}!system@{system}}
\index{system@{system}!load\+\_\+gtfs.\+cpp@{load\+\_\+gtfs.\+cpp}}
\subsubsection{\texorpdfstring{system()}{system()}}
{\footnotesize\ttfamily int system (\begin{DoxyParamCaption}\item[{std\+::string const \&}]{s }\end{DoxyParamCaption})}

A \hyperlink{load__gtfs_8cpp_acc289d9bfee4c154322662aef55c5438}{system()} command that takes a std\+::string instead of a char. 
\begin{DoxyParams}{Parameters}
{\em s} & The command to run. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The return value from the system command. 
\end{DoxyReturn}
